<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cube Hero: Boss Rush 2026</title>
    <style>
        body { margin: 0; background: #050505; color: white; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; overflow: hidden; display: flex; flex-direction: column; align-items: center; }
        canvas { background: #111; box-shadow: 0 0 30px rgba(0,0,0,0.5); cursor: crosshair; max-width: 100vw; }
        #ui { position: absolute; top: 10px; width: 950px; display: flex; justify-content: space-between; pointer-events: none; }
        .stat-box { background: rgba(0,0,0,0.7); padding: 10px; border-radius: 5px; border: 1px solid #444; }
        #shop-overlay, #death-screen { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: rgba(20,20,20,0.95); padding: 30px; border: 2px solid #00f2ff; text-align: center; display: none; z-index: 100; border-radius: 15px; }
        button { background: #00f2ff; border: none; padding: 10px 20px; cursor: pointer; font-weight: bold; margin: 5px; border-radius: 5px; }
        button:hover { background: #0088ff; }
        .skill-slot { display: inline-block; width: 50px; height: 50px; border: 2px solid #555; margin: 5px; line-height: 50px; font-size: 12px; background: #222; }
    </style>
</head>
<body>

<div id="ui">
    <div class="stat-box">
        HP: <span id="hp">100</span> | Gold: <span id="gold">0</span><br>
        Skin: <span id="currentSkin">Standard</span>
    </div>
    <div class="stat-box">
        Boss: <span id="bossName">Keiner</span> | Boss HP: <span id="bossHp">0</span><br>
        Level: <span id="lvlName">-</span>
    </div>
</div>

<div id="shop-overlay">
    <h2>SHOP & SKILLS</h2>
    <p>Wähle deine Fähigkeiten für die Slots:</p>
    <div>
        <button onclick="buySkill('Blitz', 50)">Blitz (50G)</button>
        <button onclick="buySkill('Gift', 75)">Gift (75G)</button>
        <button onclick="buySkill('Feuer', 100)">Feuer (100G)</button>
    </div>
    <p>Skins:</p>
    <button onclick="changeSkin('Red-Cube', '#ff0000', 20)">Roter Würfel (20G)</button>
    <button onclick="changeSkin('Neon-Ghost', '#00ffcc', 100)">Neon Geist (100G)</button>
    <br><br>
    <button onclick="closeShop()" style="background: #ff0055;">Weiter zum nächsten Boss</button>
</div>

<canvas id="gameCanvas"></canvas>

<script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
canvas.width = 1000;
canvas.height = 600;

// Game State
let gameState = "PLAY"; 
let gold = 0;
let currentBossIdx = 0;

// Player Setup
const player = {
    x: 100, y: 400, w: 30, h: 30,
    vx: 0, vy: 0, speed: 5, jumpPower: -12,
    hp: 100, maxHp: 100,
    grounded: false,
    color: '#00f2ff',
    skinName: 'Standard',
    skillSpace: 'Blitz', // Slot 1
    skillDown: 'Keiner', // Slot 2
    ownedSkills: ['Blitz']
};

// Maps & Bosses Definition
const levels = [
    { name: "Zerbrochene Stadt", color: "#222", gravity: 0.5, walls: [{x:300, y:400, w:100, h:200}, {x:600, y:300, w:150, h:20}] },
    { name: "Unterwasser-Grotte", color: "#002244", gravity: 0.2, walls: [{x:200, y:450, w:600, h:20}] },
    { name: "Vulkan-Krater", color: "#441100", gravity: 0.6, walls: [{x:400, y:450, w:200, h:150}] },
    { name: "Himmels-Insel", color: "#88ccff", gravity: 0.4, walls: [{x:100, y:300, w:200, h:20}, {x:700, y:300, w:200, h:20}] },
    { name: "Leere des Chaos", color: "#110022", gravity: 0.5, walls: [{x:200, y:200, w:50, h:400}, {x:750, y:200, w:50, h:400}] }
];

const bosses = [
    { name: "Eisen-Wächter", hp: 100, maxHp: 100, x: 800, y: 400, type: "Golem", color: "#777" },
    { name: "Hydro-Leviathan", hp: 150, maxHp: 150, x: 800, y: 200, type: "Fish", color: "#0055ff" },
    { name: "Magma-Dämon", hp: 250, maxHp: 250, x: 800, y: 400, type: "Demon", color: "#ff4400" },
    { name: "Sturm-Phönix", hp: 300, maxHp: 300, x: 800, y: 100, type: "Bird", color: "#ffff00" },
    { name: "Der Weltenfresser", hp: 600, maxHp: 600, x: 500, y: 300, type: "Orb", color: "#ff00ff" }
];

let particles = [];
let keys = {};

window.onkeydown = (e) => keys[e.code] = true;
window.onkeyup = (e) => keys[e.code] = false;

// Attack Logic
function fireSkill(type, direction) {
    const b = bosses[currentBossIdx];
    if(type === 'Blitz') {
        createParticle(player.x, player.y, b.x, b.y, 'cyan');
        b.hp -= 10;
    } else if(type === 'Gift') {
        b.hp -= 0.1; // Giftschaden über Zeit wäre komplexer, hier Ticks
        createParticle(player.x, player.y, b.x, b.y, 'green');
    }
}

function createParticle(x1, y1, x2, y2, color) {
    particles.push({x1, y1, x2, y2, life: 10, color});
}

function update() {
    if (gameState !== "PLAY") return;

    const lvl = levels[currentBossIdx];
    const boss = bosses[currentBossIdx];

    // Bewegung WASD + Pfeil
    if (keys['KeyA'] || keys['ArrowLeft']) player.vx = -player.speed;
    else if (keys['KeyD'] || keys['ArrowRight']) player.vx = player.speed;
    else player.vx *= 0.8;

    if ((keys['KeyW'] || keys['ArrowUp']) && player.grounded) {
        player.vy = player.jumpPower;
        player.grounded = false;
    }

    // Gravity & Physics
    player.vy += lvl.gravity;
    player.x += player.vx;
    player.y += player.vy;

    // Boden-Kollision
    if (player.y + player.h > canvas.height - 20) {
        player.y = canvas.height - 20 - player.h;
        player.vy = 0;
        player.grounded = true;
    }

    // Wand-Kollisionen
    lvl.walls.forEach(w => {
        if (player.x < w.x + w.w && player.x + player.w > w.x && player.y < w.y + w.h && player.y + player.h > w.y) {
            player.y = w.y - player.h;
            player.vy = 0;
            player.grounded = true;
        }
    });

    // Angriffe
    if(keys['Space']) fireSkill(player.skillSpace, 'up');
    if(keys['ArrowDown'] || keys['KeyS']) fireSkill(player.skillDown, 'down');

    // Boss Logik (Simpler Angriff)
    if(Math.random() < 0.02) {
        player.hp -= 2;
        if(player.hp <= 0) alert("Du bist besiegt!");
    }

    // Sieg-Check
    if (boss.hp <= 0) {
        gold += 50;
        gameState = "SHOP";
        document.getElementById('shop-overlay').style.display = 'block';
    }

    // UI Update
    document.getElementById('hp').innerText = Math.ceil(player.hp);
    document.getElementById('gold').innerText = gold;
    document.getElementById('bossHp').innerText = Math.ceil(boss.hp);
    document.getElementById('bossName').innerText = boss.name;
    document.getElementById('lvlName').innerText = lvl.name;
}

function draw() {
    const lvl = levels[currentBossIdx];
    const boss = bosses[currentBossIdx];

    // Background
    ctx.fillStyle = lvl.color;
    ctx.fillRect(0,0, canvas.width, canvas.height);

    // Walls
    ctx.fillStyle = "#444";
    lvl.walls.forEach(w => ctx.fillRect(w.x, w.y, w.w, w.h));
    ctx.fillStyle = "#222";
    ctx.fillRect(0, canvas.height-20, canvas.width, 20);

    // Player
    ctx.fillStyle = player.color;
    ctx.shadowBlur = 10; ctx.shadowColor = player.color;
    ctx.fillRect(player.x, player.y, player.w, player.h);
    ctx.shadowBlur = 0;

    // Boss Zeichnen je nach Typ
    ctx.fillStyle = boss.color;
    if(boss.type === "Fish") {
        ctx.beginPath(); ctx.ellipse(boss.x, boss.y, 40, 20, 0, 0, Math.PI*2); ctx.fill();
        ctx.moveTo(boss.x+40, boss.y); ctx.lineTo(boss.x+60, boss.y-20); ctx.lineTo(boss.x+60, boss.y+20); ctx.fill();
    } else if(boss.type === "Bird") {
        ctx.fillRect(boss.x, boss.y, 40, 30);
        ctx.fillRect(boss.x-30, boss.y, 30, 5); ctx.fillRect(boss.x+40, boss.y, 30, 5);
    } else {
        ctx.fillRect(boss.x, boss.y, 60, 60);
    }

    // Particles (Blitze etc)
    particles.forEach((p, i) => {
        ctx.strokeStyle = p.color;
        ctx.lineWidth = 3;
        ctx.beginPath(); ctx.moveTo(p.x1, p.y1); ctx.lineTo(p.x2, p.y2); ctx.stroke();
        p.life--;
        if(p.life <= 0) particles.splice(i, 1);
    });

    requestAnimationFrame(() => { update(); draw(); });
}

// Shop Funktionen
function buySkill(name, cost) {
    if(gold >= cost) {
        gold -= cost;
        player.skillDown = name;
        alert(name + " auf Abwärts-Taste ausgerüstet!");
    }
}

function changeSkin(name, color, cost) {
    if(gold >= cost) {
        gold -= cost;
        player.color = color;
        player.skinName = name;
        document.getElementById('currentSkin').innerText = name;
    }
}

function closeShop() {
    currentBossIdx = (currentBossIdx + 1) % bosses.length;
    player.hp = 100;
    player.x = 100;
    gameState = "PLAY";
    document.getElementById('shop-overlay').style.display = 'none';
}

draw();
</script>
</body>
</html>
