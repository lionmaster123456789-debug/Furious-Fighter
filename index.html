<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <title>Cube Hero: Boss Arena 2026</title>
    <style>
        body { margin: 0; background: #050505; color: #00f2ff; font-family: 'Consolas', monospace; overflow: hidden; }
        canvas { display: block; }
        #ui { position: absolute; top: 10px; left: 10px; pointer-events: none; width: 98%; }
        .hud { background: rgba(0,0,0,0.8); padding: 10px; border: 1px solid #333; margin-bottom: 5px; border-radius: 5px; }
        .bar { width: 200px; height: 10px; background: #222; border: 1px solid #555; }
        .fill { height: 100%; transition: 0.2s; }
        #shop-container { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); display: none; background: #111; border: 3px solid #00f2ff; padding: 20px; z-index: 100; border-radius: 15px; text-align: center; }
        .shop-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        button { background: #222; color: #00f2ff; border: 1px solid #00f2ff; padding: 10px; cursor: pointer; }
        button:hover { background: #00f2ff; color: #000; }
        .slot-info { display: flex; gap: 20px; font-weight: bold; color: #fff; margin-top: 5px; }
    </style>
</head>
<body>

<div id="ui">
    <div class="hud">
        HP: <div class="bar"><div id="hp-bar" class="fill" style="background: #f00; width: 100%;"></div></div>
        GOLD: <span id="gold-val">0</span> | <span id="current-loc">Lobby</span>
        <div class="slot-info">
            <div>SLOT [F]: <span id="slot-f-txt" style="color:#00f2ff">Blitz</span></div>
            <div>SLOT [S]: <span id="slot-s-txt" style="color:#f0f">Leer</span></div>
        </div>
    </div>
    <div id="boss-hud" style="display:none;" class="hud">
        BOSS HP: <div class="bar" style="width:100%"><div id="boss-bar" class="fill" style="background: #f0f; width: 100%;"></div></div>
    </div>
</div>

<div id="shop-container">
    <h2 id="shop-title">Shop</h2>
    <div id="shop-items" class="shop-grid"></div>
    <br><button onclick="closeShop()">Schließen</button>
</div>

<canvas id="gameCanvas"></canvas>

<script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
canvas.width = window.innerWidth; canvas.height = window.innerHeight;

let gold = 0, state = "LOBBY", camX = 0, activeBoss = null;
let keys = {};
let projectiles = [], enemyProjectiles = [], platforms = [], interactables = [];

const player = { 
    x: 100, y: 500, w: 40, h: 40, vx: 0, vy: 0, hp: 100, speed: 7, jump: -17, 
    grounded: false, slotF: 'Blitz', slotS: 'Keiner', 
    lastF: 0, lastS: 0, cdF: 600, cdS: 1000 
};

const BOSS_TYPES = {
    Golem: { hp: 500, color: "#666", behavior: "heavy" },
    Leviathan: { hp: 700, color: "#00f", behavior: "swim" },
    Demon: { hp: 1000, color: "#f00", behavior: "chaos" },
    Phoenix: { hp: 1200, color: "#fa0", behavior: "fly" }
};

function initLobby() {
    state = "LOBBY"; activeBoss = null; player.x = 400; camX = 0;
    platforms = [{x: 0, y: canvas.height-60, w: 2000, h: 60, type: 'solid'}];
    interactables = [
        {x: 600, y: canvas.height-120, w: 80, h: 60, type: 'shop_skill', label: 'SKILL SHOP'},
        {x: 800, y: canvas.height-120, w: 80, h: 60, type: 'shop_slot', label: 'SLOT SHOP'},
        {x: 1200, y: canvas.height-120, w: 100, h: 60, type: 'boss_select', boss: 'Golem', label: 'BOSS: GOLEM'},
        {x: 1400, y: canvas.height-120, w: 100, h: 60, type: 'boss_select', boss: 'Leviathan', label: 'BOSS: LEVIATHAN'}
    ];
    document.getElementById('boss-hud').style.display = 'none';
}

function startBoss(type) {
    state = "BOSS";
    const data = BOSS_TYPES[type];
    activeBoss = { x: 1500, y: 400, w: 120, h: 180, hp: data.hp, max: data.hp, type: type, behavior: data.behavior, phase: 0 };
    platforms = [
        {x: 0, y: canvas.height-60, w: 3000, h: 60, type: 'solid'},
        {x: 400, y: 500, w: 200, h: 20}, {x: 800, y: 400, w: 200, h: 20, tramp: true},
        {x: 1200, y: 550, w: 400, h: 20}
    ];
    document.getElementById('boss-hud').style.display = 'block';
}

function update() {
    // Movement
    if(keys['KeyA'] || keys['ArrowLeft']) player.vx = -player.speed;
    else if(keys['KeyD'] || keys['ArrowRight']) player.vx = player.speed;
    else player.vx *= 0.8;
    
    player.vy += 0.8; player.x += player.vx; player.y += player.vy;
    camX = player.x - 300;

    // Platform Collision
    player.grounded = false;
    platforms.forEach(p => {
        if(player.x < p.x+p.w && player.x+player.w > p.x && player.y+player.h > p.y && player.y+player.h < p.y+30 && player.vy >= 0) {
            if(p.tramp) player.vy = -25; else { player.y = p.y-player.h; player.vy = 0; player.grounded = true; }
        }
    });

    if(state === "BOSS" && activeBoss) {
        // Boss AI
        const b = activeBoss;
        b.phase += 0.02;
        if(b.behavior === "heavy") {
            b.x += Math.sin(b.phase) * 2;
            if(Math.random() < 0.02) enemyProjectiles.push({x: b.x, y: 0, vx: 0, vy: 10, type: 'rock'});
        } else if(b.behavior === "swim") {
            b.y = 200 + Math.sin(b.phase) * 150;
            if(Math.random() < 0.03) enemyProjectiles.push({x: b.x, y: b.y+50, vx: -12, vy: (player.y-b.y)*0.02, type: 'bubble'});
        }

        // Projectiles Collision
        projectiles.forEach((p, i) => {
            p.x += 15;
            if(p.x > b.x && p.x < b.x+b.w && p.y > b.y && p.y < b.y+b.h) {
                b.hp -= 20; projectiles.splice(i, 1);
                if(b.hp <= 0) { gold += 500; initLobby(); }
            }
        });
    }

    enemyProjectiles.forEach((p, i) => {
        p.x += p.vx || 0; p.y += p.vy || 0;
        if(Math.abs(p.x-player.x) < 40 && Math.abs(p.y-player.y) < 40) { player.hp -= 10; enemyProjectiles.splice(i, 1); }
    });

    // UI Refresh
    document.getElementById('hp-bar').style.width = player.hp + "%";
    document.getElementById('gold-val').innerText = gold;
    if(activeBoss) document.getElementById('boss-bar').style.width = (activeBoss.hp/activeBoss.max*100) + "%";
}

function draw() {
    ctx.fillStyle = "#050505"; ctx.fillRect(0,0, canvas.width, canvas.height);
    
    // Draw Platforms
    platforms.forEach(p => {
        ctx.fillStyle = p.tramp ? "#ff0" : "#333";
        ctx.fillRect(p.x-camX, p.y, p.w, p.h);
    });

    // Draw Interactables (Lobby)
    if(state === "LOBBY") {
        interactables.forEach(it => {
            ctx.fillStyle = it.type.includes('shop') ? "#00f2ff" : "#f0f";
            ctx.fillRect(it.x-camX, it.y, it.w, it.h);
            ctx.fillStyle = "#fff"; ctx.fillText(it.label, it.x-camX, it.y-10);
            if(Math.abs(player.x - it.x) < 50) {
                ctx.fillText("[E] BENUTZEN", player.x-camX, player.y-20);
                if(keys['KeyE']) handleInteract(it);
            }
        });
    }

    // Draw Boss
    if(activeBoss) {
        const b = activeBoss;
        ctx.save(); ctx.translate(b.x-camX, b.y);
        ctx.fillStyle = BOSS_TYPES[b.type].color;
        // Advanced Drawing
        ctx.fillRect(0, 0, b.w, b.h); // Körper
        ctx.fillStyle = "#fff"; ctx.fillRect(20, 30, 20, 20); ctx.fillRect(80, 30, 20, 20); // Augen
        ctx.restore();
    }

    // Player & Attacks
    ctx.fillStyle = "#00f2ff"; ctx.fillRect(player.x-camX, player.y, player.w, player.h);
    projectiles.forEach(p => {
        if(p.type === 'Blitz') {
            ctx.strokeStyle = "cyan"; ctx.beginPath(); ctx.moveTo(player.x-camX+20, player.y+20);
            ctx.lineTo(p.x-camX, p.y); ctx.stroke();
        } else { ctx.fillStyle = "orange"; ctx.beginPath(); ctx.arc(p.x-camX, p.y, 10, 0, Math.PI*2); ctx.fill(); }
    });

    enemyProjectiles.forEach(p => {
        ctx.fillStyle = "#fff"; ctx.beginPath(); ctx.arc(p.x-camX, p.y, 15, 0, Math.PI*2); ctx.fill();
    });

    requestAnimationFrame(() => { update(); draw(); });
}

function handleInteract(it) {
    if(it.type === 'boss_select') startBoss(it.boss);
    if(it.type === 'shop_skill') openShop('skills');
    if(it.type === 'shop_slot') openShop('slots');
}

function openShop(type) {
    const container = document.getElementById('shop-items');
    container.innerHTML = "";
    document.getElementById('shop-container').style.display = 'block';
    if(type === 'skills') {
        const skills = [{n:'Feuerball', p:100}, {n:'Giftwolke', p:200}, {n:'Eisstrahl', p:300}];
        skills.forEach(s => {
            container.innerHTML += `<button onclick="buySkill('${s.n}', ${s.p})">${s.n} (${s.p}G)</button>`;
        });
    } else {
        container.innerHTML = `<button onclick="buySlotS(500)">Slot [S] freischalten (500G)</button>`;
    }
}

function buySkill(name, price) {
    if(gold >= price) { gold -= price; player.slotF = name; document.getElementById('slot-f-txt').innerText = name; }
}

function buySlotS(price) {
    if(gold >= price) { gold -= price; player.slotS = "Feuerball"; document.getElementById('slot-s-txt').innerText = "Feuerball"; }
}

function closeShop() { document.getElementById('shop-container').style.display = 'none'; }

window.onkeydown = (e) => {
    keys[e.code] = true;
    const now = Date.now();
    if((e.code === 'Space' || e.code === 'KeyW') && player.grounded) player.vy = player.jump;
    if(e.code === 'KeyF' && now - player.lastF > player.cdF) {
        projectiles.push({x: player.x, y: player.y+20, type: player.slotF}); player.lastF = now;
    }
    if(e.code === 'KeyS' && player.slotS !== 'Keiner' && now - player.lastS > player.cdS) {
        projectiles.push({x: player.x, y: player.y+20, type: player.slotS}); player.lastS = now;
    }
};
window.onkeyup = (e) => keys[e.code] = false;

initLobby();
draw();
</script>
</body>
</html>
