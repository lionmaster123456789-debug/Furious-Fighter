<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <title>Cube Hero: Apocalypse 2026</title>
    <style>
        body { margin: 0; background: #050505; color: #00f2ff; font-family: 'Courier New', Courier, monospace; overflow: hidden; }
        canvas { display: block; }
        #ui-layer { position: absolute; top: 10px; left: 10px; pointer-events: none; width: 98%; }
        .bar { width: 200px; height: 15px; border: 1px solid #00f2ff; margin: 5px 0; }
        .fill { height: 100%; transition: width 0.2s; }
        #shop-menu { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: rgba(10,10,20,0.95); border: 2px solid #00f2ff; padding: 20px; display: none; grid-template-columns: 1fr 1fr; gap: 10px; z-index: 1000; }
        button { background: #111; color: #00f2ff; border: 1px solid #00f2ff; padding: 8px; cursor: pointer; }
        button:hover { background: #00f2ff; color: #000; }
    </style>
</head>
<body>

<div id="ui-layer">
    HP: <div class="bar"><div id="hp-bar" class="fill" style="background: red; width: 100%;"></div></div>
    BOSS: <div class="bar"><div id="boss-bar" class="fill" style="background: purple; width: 100%;"></div></div>
    Gold: <span id="gold-val">0</span> | Level: <span id="lvl-name">1</span>
    <div id="cooldowns">Slot 1: Bereit | Slot 2: Bereit</div>
</div>

<div id="shop-menu" id="shop">
    <h2 style="grid-column: span 2; text-align: center;">SHOP - Wähle deine Macht</h2>
    <button onclick="buySkill('Blitz', 0, 1)">Slot 1: Blitz (Start)</button>
    <button onclick="buySkill('Gift', 50, 1)">Slot 1: Gift (50G)</button>
    <button onclick="buySkill('Meteor', 150, 2)">Slot 2: Meteor (150G)</button>
    <button onclick="buySkill('Feuerball', 80, 2)">Slot 2: Feuerball (80G)</button>
    <button onclick="buySkill('Eisregen', 120, 1)">Slot 1: Eisregen (120G)</button>
    <button onclick="buySkill('Laser', 200, 2)">Slot 2: Todeslaser (200G)</button>
    <button onclick="nextLevel()" style="grid-column: span 2; background: #00f2ff; color: #000;">NÄCHSTER BOSS</button>
</div>

<canvas id="gameCanvas"></canvas>

<script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

let gold = 0;
let currentLvl = 0;
let gameState = "PLAY";
let cameraX = 0;

// Player & Skills
const player = {
    x: 100, y: 300, w: 40, h: 40, vx: 0, vy: 0, 
    hp: 100, speed: 6, jump: -15, grounded: false,
    slot1: 'Blitz', slot2: 'Keiner',
    cd1: 0, cd2: 0
};

const skillData = {
    'Blitz': { cd: 30, color: '#00ffff', damage: 15 },
    'Gift': { cd: 40, color: '#33ff33', damage: 0.5 },
    'Meteor': { cd: 100, color: '#ff4400', damage: 50 },
    'Feuerball': { cd: 50, color: '#ffaa00', damage: 20 },
    'Eisregen': { cd: 80, color: '#aaddff', damage: 10 },
    'Laser': { cd: 120, color: '#ff00ff', damage: 80 }
};

// Boss Daten & Modelle
const levels = [
    { name: "Neon-Ruinen", color: "#111", gravity: 0.8, boss: { hp: 200, type: 'golem', x: 1200, y: 400, w: 120, h: 150 } },
    { name: "Ozean-Tiefe", color: "#001133", gravity: 0.3, boss: { hp: 350, type: 'fish', x: 1500, y: 300, w: 200, h: 100 } },
    { name: "Vulkan-Kern", color: "#220000", gravity: 0.9, boss: { hp: 500, type: 'demon', x: 1800, y: 400, w: 150, h: 200 } },
    { name: "Himmels-Festung", color: "#223344", gravity: 0.6, boss: { hp: 700, type: 'bird', x: 2000, y: 200, w: 180, h: 120 } },
    { name: "Endzeit", color: "#000", gravity: 0.8, boss: { hp: 1500, type: 'titan', x: 2500, y: 200, w: 300, h: 400 } }
];

let particles = [];
let keys = {};
window.onkeydown = (e) => keys[e.code] = true;
window.onkeyup = (e) => keys[e.code] = false;

function drawBoss(b) {
    ctx.save();
    ctx.translate(b.x - cameraX, b.y);
    ctx.shadowBlur = 20; ctx.shadowColor = "purple";
    
    if(b.type === 'golem') {
        ctx.fillStyle = "#555"; ctx.fillRect(0, 0, b.w, b.h);
        ctx.fillStyle = "#f00"; ctx.fillRect(20, 20, 20, 20); ctx.fillRect(80, 20, 20, 20);
    } else if(b.type === 'fish') {
        ctx.fillStyle = "#0077ff";
        ctx.beginPath(); ctx.ellipse(b.w/2, b.h/2, b.w/2, b.h/2, 0, 0, Math.PI*2); ctx.fill();
        ctx.moveTo(0, b.h/2); ctx.lineTo(-40, 0); ctx.lineTo(-40, b.h); ctx.fill();
    } else if(b.type === 'demon') {
        ctx.fillStyle = "#aa0000"; ctx.beginPath(); ctx.moveTo(0, b.h); ctx.lineTo(b.w/2, 0); ctx.lineTo(b.w, b.h); ctx.fill();
        ctx.fillStyle = "black"; ctx.fillRect(b.w/4, b.h/2, b.w/2, 20);
    } else if(b.type === 'bird') {
        ctx.fillStyle = "gold"; ctx.fillRect(0, b.h/3, b.w, 20);
        ctx.beginPath(); ctx.arc(b.w/2, b.h/2, 30, 0, Math.PI*2); ctx.fill();
    } else { // Titan
        ctx.fillStyle = "#222"; ctx.fillRect(0,0, b.w, b.h);
        ctx.strokeStyle = "purple"; ctx.lineWidth = 5; ctx.strokeRect(0,0,b.w,b.h);
    }
    ctx.restore();
}

function spawnSkill(type) {
    const boss = levels[currentLvl].boss;
    if(type === 'Blitz') {
        let lx = player.x + 20; let ly = player.y;
        for(let i=0; i<5; i++) {
            let nextX = lx + (boss.x - lx)/5 + (Math.random()-0.5)*100;
            let nextY = ly + (boss.y - ly)/5 + (Math.random()-0.5)*100;
            particles.push({type: 'line', x1: lx, y1: ly, x2: nextX, y2: nextY, color: 'cyan', life: 15});
            lx = nextX; ly = nextY;
        }
        boss.hp -= skillData['Blitz'].damage;
    }
    if(type === 'Meteor') {
        particles.push({type: 'circle', x: boss.x + (Math.random()-0.5)*200, y: -100, ty: boss.y, r: 40, color: 'orange', vy: 10, life: 100});
    }
    if(type === 'Gift') {
        for(let i=0; i<10; i++) particles.push({type: 'smoke', x: boss.x + i*10, y: boss.y + 50, color: 'green', life: 50});
        boss.hp -= 20;
    }
}

function update() {
    if(gameState !== "PLAY") return;
    const lvl = levels[currentLvl];
    const boss = lvl.boss;

    // Movement
    if(keys['KeyA'] || keys['ArrowLeft']) player.vx = -player.speed;
    else if(keys['KeyD'] || keys['ArrowRight']) player.vx = player.speed;
    else player.vx *= 0.8;
    
    if((keys['KeyW'] || keys['ArrowUp'] || keys['Space']) && player.grounded) { player.vy = player.jump; player.grounded = false; }
    
    player.vy += lvl.gravity;
    player.x += player.vx; player.y += player.vy;
    if(player.y > canvas.height - 100) { player.y = canvas.height - 100; player.vy = 0; player.grounded = true; }

    // Skills & Cooldowns
    if(player.cd1 > 0) player.cd1--;
    if(player.cd2 > 0) player.cd2--;

    if(keys['Space'] && player.cd1 === 0) { spawnSkill(player.slot1); player.cd1 = skillData[player.slot1].cd; }
    if((keys['KeyS'] || keys['ArrowDown']) && player.cd2 === 0 && player.slot2 !== 'Keiner') { spawnSkill(player.slot2); player.cd2 = skillData[player.slot2].cd; }

    // Kamera folgt Spieler
    cameraX = player.x - 200;

    // Partikel Update
    particles.forEach((p, i) => {
        if(p.type === 'circle') { p.y += p.vy; if(p.y >= p.ty) { boss.hp -= 1; p.life = 0; } }
        p.life--; if(p.life <= 0) particles.splice(i, 1);
    });

    if(boss.hp <= 0) { gameState = "SHOP"; document.getElementById('shop-menu').style.display = 'grid'; gold += 100; }

    // UI
    document.getElementById('hp-bar').style.width = player.hp + "%";
    document.getElementById('boss-bar').style.width = (boss.hp / levels[currentLvl].boss.hp * 100) + "%";
    document.getElementById('gold-val').innerText = gold;
}

function draw() {
    ctx.fillStyle = levels[currentLvl].color;
    ctx.fillRect(0,0, canvas.width, canvas.height);

    // Spieler
    ctx.fillStyle = "#00f2ff";
    ctx.shadowBlur = 15; ctx.shadowColor = "#00f2ff";
    ctx.fillRect(player.x - cameraX, player.y, player.w, player.h);

    drawBoss(levels[currentLvl].boss);

    // Effekte
    particles.forEach(p => {
        ctx.strokeStyle = p.color; ctx.fillStyle = p.color;
        if(p.type === 'line') { ctx.beginPath(); ctx.moveTo(p.x1 - cameraX, p.y1); ctx.lineTo(p.x2 - cameraX, p.y2); ctx.stroke(); }
        if(p.type === 'circle') { ctx.beginPath(); ctx.arc(p.x - cameraX, p.y, p.r, 0, Math.PI*2); ctx.fill(); }
        if(p.type === 'smoke') { ctx.globalAlpha = 0.3; ctx.beginPath(); ctx.arc(p.x - cameraX, p.y, 20, 0, Math.PI*2); ctx.fill(); ctx.globalAlpha = 1; }
    });

    requestAnimationFrame(() => { update(); draw(); });
}

function buySkill(name, price, slot) {
    if(gold >= price) {
        gold -= price;
        if(slot === 1) player.slot1 = name;
        else player.slot2 = name;
        alert(name + " gekauft!");
    }
}

function nextLevel() {
    currentLvl++;
    player.x = 100;
    gameState = "PLAY";
    document.getElementById('shop-menu').style.display = 'none';
}

draw();
</script>
</body>
</html>
