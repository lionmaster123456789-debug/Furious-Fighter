<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <title>Cube Hero: Boss Rush 2026</title>
    <style>
        body { margin: 0; background: #000; color: #00f2ff; font-family: 'Arial', sans-serif; overflow: hidden; }
        canvas { display: block; }
        #ui { position: absolute; top: 10px; left: 10px; pointer-events: none; text-shadow: 2px 2px #000; }
        .bar { width: 250px; height: 15px; border: 1px solid #555; background: #111; margin: 5px 0; }
        #hp-fill { background: #0f0; width: 100%; height: 100%; transition: 0.1s; }
        #boss-hp-fill { background: #f0f; width: 100%; height: 100%; transition: 0.3s; }
        #shop { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: rgba(10,10,25,0.95); border: 2px solid #00f2ff; padding: 25px; display: none; text-align: center; border-radius: 15px; }
        button { background: #00f2ff; color: #000; border: none; padding: 10px 20px; margin: 5px; cursor: pointer; font-weight: bold; }
        button:hover { background: #fff; }
    </style>
</head>
<body>

<div id="ui">
    HELD HP <div class="bar"><div id="hp-fill"></div></div>
    BOSS HP <div class="bar"><div id="boss-hp-fill"></div></div>
    Gold: <span id="gold">0</span> | Level: <span id="lvl-txt">1/5</span>
</div>

<div id="shop">
    <h2 id="shop-title">BOSS ELIMINIERT!</h2>
    <div id="shop-items"></div>
    <button onclick="startNextLevel()">NÄCHSTES LEVEL</button>
</div>

<canvas id="gameCanvas"></canvas>

<script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

let gold = 0, currentLvl = 0, gameState = "PLAY", camX = 0;
let keys = {};
let projectiles = [];
let enemyProjectiles = [];
let particles = [];
let platforms = [];

const player = { x: 100, y: 500, w: 40, h: 40, vx: 0, vy: 0, hp: 100, speed: 7, jump: -16, grounded: false, slot1: 'Blitz', slot2: 'Keiner' };

const levels = [
    { name: "Apokalypse-Stadt", color: "#1a1a1a", grav: 0.7, groundType: 'solid', 
      boss: { x: 2800, y: 400, hp: 300, max: 300, type: 'Golem', atkType: 'rock' } },
    { name: "Ozean des Grauens", color: "#001f3f", grav: 0.3, groundType: 'toxic', 
      boss: { x: 3000, y: 300, hp: 500, max: 500, type: 'Leviathan', atkType: 'bubble' } },
    { name: "Vulkan-Hölle", color: "#330000", grav: 0.8, groundType: 'lava', 
      boss: { x: 3200, y: 400, hp: 800, max: 800, type: 'Demon', atkType: 'fire' } },
    { name: "Sturm-Gipfel", color: "#222", grav: 0.6, groundType: 'solid', 
      boss: { x: 3500, y: 200, hp: 1200, max: 1200, type: 'Vogel', atkType: 'wind' } },
    { name: "Die Leere", color: "#0a001a", grav: 0.7, groundType: 'void', 
      boss: { x: 4000, y: 300, hp: 2500, max: 2500, type: 'Omega', atkType: 'void' } }
];

function setupLevel() {
    const lvl = levels[currentLvl];
    platforms = [
        {x: 0, y: canvas.height-50, w: 5000, h: 50, type: lvl.groundType}, // Boden
        {x: 600, y: 500, w: 200, h: 20}, {x: 1000, y: 400, w: 100, h: 20, special: 'tramp'},
        {x: 1500, y: 300, w: 300, h: 20}, {x: 2000, y: 450, w: 200, h: 20, special: 'tramp'}
    ];
    player.x = 100; player.vx = 0; player.vy = 0;
    projectiles = []; enemyProjectiles = [];
}

function drawLightning(x1, y1, x2, y2) {
    ctx.strokeStyle = "#00f2ff";
    ctx.lineWidth = 3;
    ctx.beginPath();
    ctx.moveTo(x1 - camX, y1);
    let lx = x1, ly = y1;
    for(let i=0; i<5; i++) {
        lx += (x2 - x1)/5 + (Math.random()-0.5)*50;
        ly += (y2 - y1)/5 + (Math.random()-0.5)*50;
        ctx.lineTo(lx - camX, ly);
    }
    ctx.lineTo(x2 - camX, y2);
    ctx.stroke();
}

function update() {
    if(gameState !== "PLAY") return;
    const lvl = levels[currentLvl];
    const boss = lvl.boss;

    // Movement & Physik
    if(keys['ArrowLeft'] || keys['KeyA']) player.vx = -player.speed;
    else if(keys['ArrowRight'] || keys['KeyD']) player.vx = player.speed;
    else player.vx *= 0.8;
    
    player.vy += lvl.grav; player.x += player.vx; player.y += player.vy;
    camX = player.x - 200;

    // Kollisionen
    platforms.forEach(p => {
        if(player.x < p.x + p.w && player.x + player.w > p.x && player.y + player.h > p.y && player.y < p.y + p.h && player.vy > 0) {
            if(p.special === 'tramp') { player.vy = -25; }
            else { player.y = p.y - player.h; player.vy = 0; player.grounded = true; }
            if(p.type === 'lava' || p.type === 'toxic') player.hp -= 0.5;
        }
    });

    // Boss KI Angriffe
    if(Math.random() < 0.02 && Math.abs(player.x - boss.x) < 800) {
        enemyProjectiles.push({x: boss.x, y: boss.y + 50, vx: -10, vy: (Math.random()-0.5)*5, type: boss.atkType});
    }

    // Projektile Update
    projectiles.forEach((p, i) => {
        p.x += 15;
        if(Math.abs(p.x - boss.x) < 100) {
            boss.hp -= 20; projectiles.splice(i, 1);
            if(boss.hp <= 0) { gameState = "SHOP"; document.getElementById('shop').style.display = 'block'; gold += 200; }
        }
    });

    enemyProjectiles.forEach((p, i) => {
        p.x += p.vx; p.y += p.vy;
        if(Math.abs(p.x - player.x) < 40 && Math.abs(p.y - player.y) < 40) {
            player.hp -= 10; enemyProjectiles.splice(i, 1);
        }
    });

    // UI
    document.getElementById('hp-fill').style.width = player.hp + "%";
    document.getElementById('boss-hp-fill').style.width = (boss.hp / boss.max * 100) + "%";
    document.getElementById('gold').innerText = gold;
}

function draw() {
    const lvl = levels[currentLvl];
    ctx.fillStyle = lvl.color;
    ctx.fillRect(0,0, canvas.width, canvas.height);

    // Plattformen zeichnen
    platforms.forEach(p => {
        ctx.fillStyle = p.type === 'lava' ? '#f40' : (p.type === 'toxic' ? '#0f0' : '#444');
        if(p.special === 'tramp') ctx.fillStyle = 'yellow';
        ctx.fillRect(p.x - camX, p.y, p.w, p.h);
    });

    // Boss zeichnen
    ctx.save();
    ctx.translate(lvl.boss.x - camX, lvl.boss.y);
    ctx.fillStyle = "purple";
    if(lvl.boss.type === 'Golem') ctx.fillRect(0,0, 100, 150);
    if(lvl.boss.type === 'Leviathan') { ctx.beginPath(); ctx.arc(50, 50, 60, 0, Math.PI*2); ctx.fill(); }
    if(lvl.boss.type === 'Demon') { ctx.beginPath(); ctx.moveTo(0,100); ctx.lineTo(50,0); ctx.lineTo(100,100); ctx.fill(); }
    ctx.restore();

    // Player & Attacken
    ctx.fillStyle = "#00f2ff";
    ctx.fillRect(player.x - camX, player.y, player.w, player.h);

    projectiles.forEach(p => {
        if(player.slot1 === 'Blitz') drawLightning(p.x - 50, p.y + 20, p.x, p.y + 20);
        else { ctx.fillStyle = 'red'; ctx.beginPath(); ctx.arc(p.x - camX, p.y, 10, 0, Math.PI*2); ctx.fill(); }
    });

    enemyProjectiles.forEach(p => {
        ctx.fillStyle = 'white'; ctx.beginPath(); ctx.arc(p.x - camX, p.y, 15, 0, Math.PI*2); ctx.fill();
    });

    requestAnimationFrame(() => { update(); draw(); });
}

window.onkeydown = (e) => {
    keys[e.code] = true;
    if(e.code === 'Space') projectiles.push({x: player.x, y: player.y, type: player.slot1});
};
window.onkeyup = (e) => keys[e.code] = false;

function startNextLevel() {
    currentLvl++;
    document.getElementById('shop').style.display = 'none';
    gameState = "PLAY";
    setupLevel();
}

setupLevel();
draw();
</script>
</body>
</html>
